{% extends "baseLayout.html" %}

{% block title %}Admin Dashboard – GSO Marketplace{% endblock %}

{% block content %}

{% set booking_list = bookings|list %}

<div class="full-width-banner">
  <div class="banner-inner">
    <h1>Admin Dashboard</h1>
  </div>
</div>

<div class="dashboard-container">

  <div class="dashboard-intro">
    <h2 class="welcome-title">Übersicht Anmeldungen</h2>
    <p class="welcome-sub">Verwalten Sie hier alle Anmeldungen von Firmen.</p>
  </div>

  <section class="dash-card filter-card">
    <h3 class="card-title">Filter</h3>

    <form class="filter-grid" method="GET" action="{{ url_for('dashboard') }}">
      <input type="hidden" name="report_type" value="bookings">
      <div class="filter-group">
        <label for="filter-status">Status</label>
        <select id="filter-status" name="status" class="admin-select" onchange="this.form.submit()">
          <option value="all" {% if request.args.get('status') == 'all' or not request.args.get('status') %}selected{% endif %}>Alle anzeigen</option>
          <option value="open" {% if request.args.get('status') == 'open' %}selected{% endif %}>Offen (Wartend)</option>
          <option value="confirmed" {% if request.args.get('status') == 'confirmed' %}selected{% endif %}>Bestätigt</option>
          <option value="rejected" {% if request.args.get('status') == 'rejected' %}selected{% endif %}>Abgelehnt</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-day">Teilnahmetag</label>
        <select id="filter-day" name="day" class="admin-select" onchange="this.form.submit()">
          <option value="all" {% if request.args.get('day') == 'all' or not request.args.get('day') %}selected{% endif %}>Alle Tage</option>
          <option value="tag1" {% if request.args.get('day') == 'tag1' %}selected{% endif %}>Freitag (Tag 1)</option>
          <option value="tag2" {% if request.args.get('day') == 'tag2' %}selected{% endif %}>Samstag (Tag 2)</option>
          <option value="both" {% if request.args.get('day') == 'both' %}selected{% endif %}>Beide Tage</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="filter-industry">Branche</label>
        <select id="filter-industry" name="industry" class="admin-select" onchange="this.form.submit()">
          <option value="all" {% if request.args.get('industry') == 'all' or not request.args.get('industry') %}selected{% endif %}>Alle Branchen</option>
          <option value="it" {% if request.args.get('industry') == 'it' %}selected{% endif %}>IT & Software</option>
          <option value="finance" {% if request.args.get('industry') == 'finance' %}selected{% endif %}>Wirtschaft & Verwaltung</option>
          <option value="craft" {% if request.args.get('industry') == 'craft' %}selected{% endif %}>Handwerk</option>
        </select>
      </div>

      <div class="filter-actions">

        <a href="{{ url_for('dashboard') }}" class="btn-small-outline">
            Reset
        </a>
      </div>
    </form>
  </section>

  <div id="bookings">
    <section class="dash-card results-card">
      <div class="header-row">
        <h3 class="card-title" style="margin-bottom:0; border:none;">Anmeldungen ({{ booking_list|length }})</h3>
        <div class="no-print">
          <button class="btn-small-outline" onclick="printElement('bookings')">Drucken</button>
          <button class="btn-small-outline" onclick="exportCSV('bookings')">Export CSV</button>
        </div>
      </div>

      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Firma</th>
              <th>Ansprechpartner</th>
              <th>Branche</th>
              <th>Tage</th>
              <th>Status</th>
              <th class="text-right no-print">Aktionen</th>
            </tr>
          </thead>
          <tbody>
          {% for booking in booking_list %}
            <tr>
              <td data-label="Firma" class="fw-bold">{{ booking.user.name }}</td>
              <td data-label="Ansprechpartner">{{ booking.user.contact_person }}</td>
              <td data-label="Branche">{{ booking.user.industry if booking.user.industry else "-" }}</td>
              <td data-label="Dauer">{{ booking.duration }} Tag(e)</td>
              <td data-label="Status">
                <span class="status-badge status-{{ booking.status.name|lower }}">
                  {{ booking.status.value }}
                </span>
              </td>
              <td data-label="Aktionen" class="text-right action-cell no-print">
                <form action="/admin/booking/{{ booking.id }}/confirm" method="POST" style="display:inline;">
                  <button type="submit" class="btn-icon btn-approve" title="Anmeldung bestätigen">
                      ✔️
                  </button>
                </form>
                <form action="/admin/booking/{{ booking.id }}/reject" method="POST" style="display:inline;" onsubmit="return confirm('Möchten Sie diese Anmeldung wirklich ablehnen?');">
                  <button type="submit" class="btn-icon btn-reject" title="Anmeldung ablehnen">
                      ❌
                  </button>
                </form>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </section>
  </div>
</div>

<script src="{{ url_for('static', filename='js/dashboard_export.js') }}"></script>

{% endblock %}