{% extends "baseLayout.html" %}

{% block title %}Admin: Hallenbelegung – GSO Marketplace{% endblock %}

{% block content %}

<div class="full-width-banner">
  <div class="banner-inner">
    <h1>Hallenbelegung</h1>
    <form action="/logout"><button class="btn-small-outline btn-white-background">Logout</button></form>
  </div>
</div>

<div class="dashboard-container">

  <div class="dashboard-intro">
    <h2 class="welcome-title">Übersicht Hallenbelegung</h2>
    <p class="welcome-sub">Hier können Sie die Belegung der Ausstellungsräume an den verschiedenen Ausstellungstagen einsehen.</p>
  </div>

  <section class="dash-card filter-card">
    <div class="header-row">
      <h3 class="card-title" style="margin-bottom:0; border:none;">Austellungstag</h3>
      <div class="no-print">
        <button class="btn-small-outline" onclick="printElement('floorplan')">Drucken</button>
        <button class="btn-small-outline" onclick="exportCSV('floor_plan')">Export CSV</button>
      </div>
    </div>

    <form class="filter-grid" method="GET" action="#">
      <input type="hidden" name="report_type" value="floor_plan">

      <div class="filter-group">
        <select id="filter-day" name="day" class="admin-select" onchange="this.form.submit()">
          <option value="all" {% if request.args.get('day') == 'all' or not request.args.get('day') %}selected{% endif %}>Alle Tage</option>
          <option value="first" {% if request.args.get('day') == 'first' %}selected{% endif %}>Freitag (Tag 1)</option>
          <option value="second" {% if request.args.get('day') == 'second' %}selected{% endif %}>Samstag (Tag 2)</option>
        </select>
      </div>

      <div class="filter-actions">

        <a href="#" class="btn-small-outline">
          Reset
        </a>
      </div>
    </form>
  </section>
  <div id="floorplan">
    {% for day in floor_plan.days %}

    <h2>{{ day.name }}</h2>

    {% for hall in day.halls %}

    <section class="dash-card results-card">
      <div class="header-row">
      <h3 class="card-title" style="margin-bottom:0; border:none;">{{ hall.hall.name|d('Halle ' + loop.index|string) }} ({{ hall.bookings|length }} Anmeldungen)</h3>
      </div>

      <div class="table-responsive">
        <table class="admin-table">
          <thead>
            <tr>
              <th>Firma</th>
              <th>Ansprechpartner</th>
              <th>Branche</th>
              <th>Benötigte Stühle</th>
              <th>Benötigte Tische</th>
            </tr>
          </thead>
          <tbody>
            {% for booking in hall.bookings %}
            <tr>
              <td data-label="Firma" class="fw-bold">{{ booking.user.name }}</td>

              <td data-label="Ansprechpartner">{{ booking.user.contact_person }}</td>

              <td data-label="Branche">{{ booking.user.industry if booking.user.industry and booking.user.industry != 'None' else '-' }}</td>

              <td data-label="Benötigte Stühle">{{ booking.chairs_needed if booking.chairs_needed else '0' }}</td>

              <td data-label="Benötigte Tische">{{ booking.tables_needed if booking.tables_needed else '0' }}</td>
            </tr>
            {% endfor %}
            <tr style="border-top: 3px solid #ccc;">
              <td data-label="Firma" class="fw-bold">Gesamt</td>
              <td data-label="Ansprechpartner"></td>
              <td data-label="Branche"></td>
              <td data-label="Benötigte Stühle">{{ hall.chairs }}</td>
              <td data-label="Benötigte Tische">{{ hall.tables }}</td>
          </tbody>
        </table>
      </div>
    </section>

    {% endfor %}

    {% endfor %}
  </div>
</div>
<script src="{{ url_for('static', filename='js/dashboard_export.js') }}"></script>

{% endblock %}
